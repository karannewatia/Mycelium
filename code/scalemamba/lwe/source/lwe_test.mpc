execfile('/root/SCALE-MAMBA/Programs/lwe/lwe.mpc')

#p = 3843321857
w = cint(3457723958)

lgN = 4
r = Ring(lgN, w)

N = 1
lgM = 10
l = 4
lwe = LWE(r, N, lgM, l)

x = sint.Array(l)
for i in range(l):
  x[i] = sint(i)
  print_ln("%s ", x[i].reveal())

[a, b, s] = lwe.key_gen()
[u, v] = lwe.enc(a, b, x)
x2 = lwe.dec(u, v, s)

#[b, a, s] = lwe.key_gen()
#[c1, c0] = lwe.enc(b, a, x)
#x2 = lwe.dec(c0, c1, s)

#g = lwe.decompose_gadget()
#print_ln("decompose gadget done")
#[s1, u1, v1] = lwe.key_switching(g, s)
#print_ln("key switching done")
#[v2, u2] = lwe.new_ciphertext(v, u, v1, u1)
#print_ln("new ciphertext done")
#x2 = lwe.dec(u2, v2, s1)


#[u1, v1] = lwe.enc(a, b, x)
#u2 = lwe.add(u, u1)
#v2 = lwe.add(v, v1)
#x2 = lwe.dec(u2, v2, s)


for i in range(l):
  x2[i].reveal_to(0)
  print_ln("%s ", x2[i].reveal())
